*******
## WEB3
*******
"Новая итерация" интернета с использованием технологий блокчейна и распределенных данных.

> В настоящее время в блокчейне хранится минимум данных, поэтому децентрализация в данном случае условная. Основные данные самих децентрализованных приложений, их логики хранится на чьих-либо серверах. Также к примеру плагины и приложения доступа к кошельку работают посредством браузеров. Потенциальная уязвимость. 

Отличия от WEB 2 
- Верифицируемость
- Не требуются доверенные центры
- Самоуправляемость
- Не требуются разрешения
- Распределенность и надежность
- Наличие состояния
- Нативные платежи 

Статьи
[Хабр](https://habr.com/ru/post/651077/)

Приложения web3 работают либо на блокчейне, либо в децентрализованных сетях из множества одноранговых узлов (серверов), либо в комбинации этих двух технологий, образующих криптоэкономический протокол. Такие приложения часто называют dapps (децентрализованные приложения).

Криптовалюта играет большую роль во многих из этих протоколов. Она обеспечивает финансовый стимул (токены) для тех, кто хочет принять участие в создании, управлении, внесении вклада или улучшении одного из проектов.

Эти протоколы часто предлагают различные услуги, такие как вычисления, хранение данных, пропускная способность, идентификация, хостинг и другие веб-услуги, которые в прошлом обычно предоставлялись облачными провайдерами.

В большинстве случаев в приложениях web3 идентификация будет привязана к адресу кошелька пользователя, взаимодействующего с приложением.

В отличие от таких методов аутентификации web2, как OAuth или email + пароль (которые почти всегда требуют от пользователей передачи конфиденциальной и личной информации), адреса кошельков полностью анонимны, если только пользователь не решит публично связать с ними свою личность.
Если пользователь решит использовать один и тот же кошелек в нескольких dapps, его личность также будет легко переноситься между приложениями, что позволит ему со временем создать свою репутацию.

> Отдельный вопрос - безопасность самих кошельков

Протоколы и инструменты, как Ceramic и IDX позволяют разработчикам встраивать самосуверенную идентификацию в свои приложения для замены традиционных уровней аутентификации и идентификации. Проработка проблемы продолжается.

#### Для разработки требуется выбрать блокчейн, в котором будет храниться код.

Этериум популярен, но имеет существенный недостаток:
маcштабирование (хранить в нем данные очень дорого - к примеру NFT, работающий на этериуме, не находится в блокчейне, она хранится в другом месте - на сервере, в блокчейне есть ссылка и подтверждение "уникальности").

Также конкретные технологии блокчейна имеют свою скорость обновления (TPS). 

Альтернатива - InternetComputer (ICP) - маcштабируемый облачный сервер, основанный на блокчейне.

Вычислительные мощности берутся от подключенных машин.
Также используются т.н. Canister Smart Contracts (хранят данные, извлекают и обрабатывают код. В чем-то похоже на docker). Доступ к ним может быть получен напрямую через протокол https. 

Структура canister - 1) Web Assembly module, 2) Memory pages. Код в памяти постоянно выполняется, то есть данные не нужно хранить в базах данных для очередной итерации.

[Подготовка локального компьютера для работы с ICP](https://att-c.udemycdn.com/2022-04-06_14-02-04-144a4e33f590c784015435b3d6041a4f/original.pdf?response-content-disposition=attachment%3B+filename%3DInstallation%2Band%2BSetup%2Bfor%2BWindows.pdf&Expires=1651158362&Signature=EU6MG69dFti3xv6A0KbOfYAHc1GmF5X0rzLLSbFFaOEtctT~YHLSFdg4F2DtunMW1Kdl787qcDn~UtGB2w-nrwV3-q-FoYnp4ScWg5ZtYzMzbQOxOIUtuAKTu0vfJhnWgYT2ipCWlXuZq8SsWYzKf7sM2KMBKO6rTrbsM-qQZJBMGdL2ZzFe96vsPsPqFnAEgAji9RFS1y-K6W54rlXrgVp0WFlfzc49WgmgVuE0WdTaWTGYz~jp1Jrf9qo3J1aBOAthW5BBKqyyJ-bEdXeTLcGb3W-g80FcCz1oGnv01Gmqxm8qoStgclVsffwu-qbohf3kzeec7pxzGjm~ELmKvw__&Key-Pair-Id=APKAITJV77WS5ZT7262A)

## Motoko

[Для DApps используется язык Motoko](https://smartcontracts.org/docs/language-guide/style.html)

`import Debug "mo:base/Debug"` - для активизации режима разработчика. Импортируется соответствующая библиотека
`Debug.print(debug_show(переменная, не являющаяся текстом))` - для отображения значений не являющихся текстом

Для взаимодействия с канстрами в процессе разработки можно использовать как UI - [Candid](https://smartcontracts.org/docs/candid-guide/candid-concepts.html)

#### Используется концепция "orthogonal persistence" - "ортогональное постоянство"
При перезапуске канистры\приложения значения сохраняются в том состоянии какое было после всех вычислений с ними

Переменные:
var - объявление переменной, которая может меняться,
stable var - объявление переменной, которая может меняться и которая будет "ортогонально постоянной"

let - объявление переменной, которая не может меняться.

Функции:
func () {
}; - объявление приватной функции

public func () {
}; - объявление публичной функции. ; - обязательно после каждой функции

func (параметр: Nat) \\ Nat - тип данных, натуральное число

Операторы:
:= удалить старое значение, записать новое
+= добавить значение
-= удалить значение

Состояния и аннотации:

let tempValue: Int = необходимое значание\\ применятся для типизации данных, которые затем используются в функциях. Int - положительные и отрицательные числа

Методы:

1_Update - апдейт состояния. Использует блокчейн, требует подтверждение консенсуса
> по умолчанию. см. примеры выше 

2_Query - запрос состояния

> Пример создания
`public query func название функции (): async Nat
{
    return значение
}

#### Подключение html и css
стандартный формат, в шаблоне указан вариант 

#### Подключение js

в index.js покдлючение модуля 
import { название модуля } from "../../declarations/название модуля ";

#### Работа в терминале
npm i
dfx start
во втором терминале - dfx deploy (запуск приложения на локальной машине)
npm start

#### Подключение приложения к ICP Live Blockchain
см. документацию

#### Подключение статического сайта к ICP Live Blockchain
1) поместить весь код в папку assets
2) на одном уровне с папкой assets создать файл dfx.json (описание как канистры выглядят в ICP)
```
{
    "canisters":
    {
       "canisterName":
       {
           "type": "assets",
           "source": ["assets"]
        }
    }
}
```
3) ! при загрузке в ICP структура файлов меняется - все файлы будут на одном уровне ! нужно удалить все указания на папки/директории в коде кроме названия самих файлов

### Использование совместно с React
1) создать новый ICP шаблон `dfx new название`
2) заменить html, css, js на файлы из нужного проекта. Расширение js меняется на jsx в названии файла и в webpack.config.js (module.exports) 
3) в файле webpack.config.js откомментировать нужный фрагмент
4) добавить файл tsconfig.json
```
{
  "compilerOptions": {
    "target": "es2018",        /* Specify ECMAScript target version: 'ES3' (default), 'ES5', 'ES2015', 'ES2016', 'ES2017', 'ES2018', 'ES2019' or 'ESNEXT'. */
    "lib": ["ES2018", "DOM"],  /* Specify library files to be included in the compilation. */
    "allowJs": true,           /* Allow javascript files to be compiled. */
    "jsx": "react",            /* Specify JSX code generation: 'preserve', 'react-native', or 'react'. */
  },
  "include": ["src/**/*"],
}
```
5) в package.json заменить код на подобный
```
{
    "name": "dkeeper_assets",
    "version": "0.1.0",
    "description": "Internet Computer starter application",
    "keywords": [
        "Internet Computer",
        "Motoko",
        "JavaScript",
        "Canister"
    ],
    "scripts": {
        "build": "webpack",
        "prebuild": "npm run copy:types",
        "start": "webpack serve --mode development --env development",
        "prestart": "npm run copy:types",
        "copy:types": "rsync -avr .dfx/$(echo ${DFX_NETWORK:-'**'})/canisters/** --exclude='assets/' --exclude='idl/' --exclude='*.wasm' --delete src/declarations"
    },
    "devDependencies": {
        "@dfinity/agent": "0.10.3",
        "@dfinity/candid": "0.10.3",
        "@dfinity/principal": "0.10.3",
        "@material-ui/core": "4.6.1",
        "@material-ui/icons": "4.5.1",
        "assert": "2.0.0",
        "buffer": "6.0.3",
        "copy-webpack-plugin": "^10.2.4",
        "css-loader": "^6.5.1",
        "events": "3.3.0",
        "html-webpack-plugin": "5.5.0",
        "process": "0.11.10",
        "stream-browserify": "3.0.0",
        "style-loader": "^3.3.1",
        "terser-webpack-plugin": "5.3.1",
        "ts-loader": "^9.2.6",
        "typescript": "^4.5.5",
        "util": "0.12.4",
        "webpack": "5.69.1",
        "webpack-cli": "4.9.2",
        "webpack-dev-server": "^4.4.0"
    },
    "browserslist": [
        "last 2 chrome version",
        "last 2 firefox version",
        "last 2 safari version",
        "last 2 edge version"
    ],
    "dependencies": {
        "@material-ui/core": "4.6.1",
        "@material-ui/icons": "4.5.1",
        "react": "^16.8.2",
        "react-dom": "^16.8.2",
        "react-scripts": "5.0.0",
        "uuid": "8.3.2"
    }
}
```
## Создание собственных токенов на ICP
[Пример маркетплейса] (https://curve.fi)

Различия coin и tokens
coin      - приурочены к конкретному блокчейну
tokens - использует сторонний блокчейн

## NFT Marketplace

